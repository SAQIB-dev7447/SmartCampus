<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Text-Based Campus Analytics Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#11c4d4",
                        "background-light": "#f6f8f8",
                        "background-dark": "#102022",
                    },
                    fontFamily: {
                        "display": ["Public Sans"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-800 dark:text-slate-100 antialiased">
    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col">
            <div class="p-6 flex items-center gap-3">
                <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center text-white">
                    <span class="material-icons">analytics</span>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-slate-900 dark:text-white leading-tight">
                    Campus<br /><span class="text-primary">Admin</span></h1>
            </div>
            <nav class="flex-1 px-4 py-4 space-y-2">
                <a class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors"
                    href="{{ url_for('admin.dashboard') }}">
                    <span class="material-icons">dashboard</span>
                    <span class="font-medium">Overview</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors"
                    href="{{ url_for('admin.dashboard') }}">
                    <span class="material-icons">list_alt</span>
                    <span class="font-medium">Issue List</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 bg-primary/20 text-primary rounded-lg transition-colors"
                    href="{{ url_for('admin.analytics') }}">
                    <span class="material-icons">insights</span>
                    <span class="font-medium">Analytics</span>
                </a>
                <a class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors"
                    href="#">
                    <span class="material-icons">people</span>
                    <span class="font-medium">Departmental Staff</span>
                </a>
                <div class="pt-4 mt-4 border-t border-slate-100 dark:border-slate-800">
                    <a class="flex items-center gap-3 px-4 py-3 text-slate-500 hover:bg-primary/10 hover:text-primary rounded-lg transition-colors"
                        href="#">
                        <span class="material-icons">settings</span>
                        <span class="font-medium">Settings</span>
                    </a>
                </div>
            </nav>
            <div class="p-4 border-t border-slate-100 dark:border-slate-800">
                <div class="bg-background-light dark:bg-slate-800 p-4 rounded-xl flex items-center gap-3">
                    <div
                        class="w-8 h-8 rounded-full bg-primary/30 flex items-center justify-center text-primary text-xs font-bold">
                        {{ session.fullname|initials }}</div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm font-semibold truncate text-slate-900 dark:text-white">{{ session.fullname }}
                        </p>
                        <p class="text-xs text-slate-500 truncate">Facilities Director</p>
                    </div>
                </div>
            </div>
        </aside>
        <main class="flex-1 overflow-y-auto">
            <header
                class="sticky top-0 z-10 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 px-8 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-900 dark:text-white">Campus Issue Analytics</h2>
                        <p class="text-slate-500 text-sm">Review performance metrics and resolution trends.</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div
                            class="bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 px-3 py-2 rounded-lg flex items-center gap-2">
                            <span class="material-icons text-slate-400 text-sm">calendar_today</span>
                            <span class="text-sm font-medium">Last 30 Days</span>
                            <span class="material-icons text-slate-400 text-sm">expand_more</span>
                        </div>
                        <button
                            class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition-all shadow-sm">
                            <span class="material-icons text-sm">file_download</span>
                            Export Report
                        </button>
                    </div>
                </div>
            </header>
            <div class="p-8 space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div
                                class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                                <span class="material-icons">timer</span>
                            </div>
                            <span class="text-green-500 text-sm font-semibold flex items-center">{{
                                "%.1f"|format(avg_resolution_hours)
                                }}h</span>
                        </div>
                        <p class="text-slate-500 text-sm font-medium mb-1">Avg. Resolution Time</p>
                        <h3 class="text-2xl font-bold text-slate-900 dark:text-white">{{
                            "%.1f"|format(avg_resolution_hours) }} Hours
                        </h3>
                    </div>
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div
                                class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                                <span class="material-icons">domain</span>
                            </div>
                            <span class="text-slate-400 text-sm font-medium italic">High Traffic</span>
                        </div>
                        <p class="text-slate-500 text-sm font-medium mb-1">Most Reported Location</p>
                        <h3 class="text-2xl font-bold text-slate-900 dark:text-white mb-4">{{ top_location.location if
                            top_location else 'N/A' }}</h3>
                        <div class="grid grid-cols-2 gap-3 pt-4 border-t border-slate-100 dark:border-slate-800">
                            <div>
                                <p class="text-[10px] uppercase tracking-wider text-slate-400 font-bold mb-0.5">Reports
                                </p>
                                <p class="text-sm font-semibold text-slate-700 dark:text-slate-200">{{ top_location.cnt
                                    if top_location else 0 }}</p>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase tracking-wider text-slate-400 font-bold mb-0.5">Total
                                </p>
                                <p class="text-sm font-semibold text-slate-700 dark:text-slate-200">{{ total }}</p>
                            </div>
                        </div>
                    </div>
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div
                                class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                                <span class="material-icons">priority_high</span>
                            </div>
                            <span class="text-red-500 text-sm font-semibold flex items-center">Critical</span>
                        </div>
                        <p class="text-slate-500 text-sm font-medium mb-1">Active Critical Issues</p>
                        <h3 class="text-2xl font-bold text-slate-900 dark:text-white">{{ active_critical }}</h3>
                    </div>
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div
                                class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center text-primary">
                                <span class="material-icons">check_circle</span>
                            </div>
                            <span class="text-green-500 text-sm font-semibold">{{ resolution_rate|int }}% Rate</span>
                        </div>
                        <p class="text-slate-500 text-sm font-medium mb-1">Total Resolved Today</p>
                        <h3 class="text-2xl font-bold text-slate-900 dark:text-white">{{ resolved_today }}</h3>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div
                        class="lg:col-span-2 bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center justify-between mb-8">
                            <h4 class="text-lg font-bold text-slate-900 dark:text-white">Issues by Category</h4>
                            <button class="text-slate-400 hover:text-primary transition-colors">
                                <span class="material-icons">more_vert</span>
                            </button>
                        </div>
                        <div class="h-64 relative">
                            <canvas id="issuesChart"></canvas>
                        </div>
                    </div>
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                        <div class="flex items-center justify-between mb-8">
                            <h4 class="text-lg font-bold text-slate-900 dark:text-white">Issues by Status</h4>
                            <button class="text-slate-400 hover:text-primary transition-colors">
                                <span class="material-icons">info</span>
                            </button>
                        </div>
                        {% set resolved_pct = 0 %}
                        {% set in_progress_pct = 0 %}
                        {% set submitted_pct = 0 %}
                        {% for s in statuses %}
                        {% if s.status == 'Resolved' %}
                        {% set resolved_pct = (s.cnt / total * 100)|round|int if total > 0 else 0 %}
                        {% elif s.status == 'In Progress' %}
                        {% set in_progress_pct = (s.cnt / total * 100)|round|int if total > 0 else 0 %}
                        {% elif s.status == 'Submitted' %}
                        {% set submitted_pct = (s.cnt / total * 100)|round|int if total > 0 else 0 %}
                        {% endif %}
                        {% endfor %}
                        <div class="relative w-48 h-48 mx-auto mb-8">
                            <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                <circle class="stroke-slate-100 dark:stroke-slate-800" cx="18" cy="18" fill="none"
                                    r="16" stroke-width="4"></circle>
                                {% for s in statuses %}
                                {% if s.status == 'Resolved' %}
                                <circle class="stroke-primary" cx="18" cy="18" fill="none" r="16"
                                    stroke-dasharray="{{ (s.cnt / total * 100)|int if total > 0 else 0 }} 100"
                                    stroke-linecap="round" stroke-width="4"></circle>
                                {% elif s.status == 'In Progress' %}
                                <circle class="stroke-emerald-400" cx="18" cy="18" fill="none" r="16"
                                    stroke-dasharray="{{ (s.cnt / total * 100)|int if total > 0 else 0 }} 100"
                                    stroke-dashoffset="-{{ (statuses|selectattr('status','equalto','Resolved')|map(attribute='cnt')|first|default(0)) / total * 100|int if total > 0 else 0 }}"
                                    stroke-linecap="round" stroke-width="4"></circle>
                                {% endif %}
                                {% endfor %}
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center flex-col">
                                <span class="text-2xl font-bold text-slate-900 dark:text-white">{{ total }}</span>
                                <span class="text-xs text-slate-500">Total</span>
                            </div>
                        </div>
                        <div class="space-y-3">
                            {% for s in statuses %}
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    {% if s.status == 'Resolved' %}
                                    <span class="w-3 h-3 rounded-full bg-primary"></span>
                                    {% elif s.status == 'In Progress' %}
                                    <span class="w-3 h-3 rounded-full bg-emerald-400"></span>
                                    {% else %}
                                    <span class="w-3 h-3 rounded-full bg-amber-400"></span>
                                    {% endif %}
                                    <span class="text-sm font-medium text-slate-600 dark:text-slate-400">{{ s.status
                                        }}</span>
                                </div>
                                <span class="text-sm font-bold">{{ (s.cnt / total * 100)|round|int if total > 0 else 0
                                    }}%</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- Top Areas and Summary -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-12">
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                        <h4 class="text-sm font-bold text-slate-900 dark:text-white uppercase tracking-wider mb-4">Top
                            Reported Areas</h4>
                        <div class="space-y-3">
                            {% for area in top_areas %}
                            <div
                                class="p-3 {% if loop.first %}bg-primary/5 rounded-lg border border-primary/10{% else %}bg-slate-50 dark:bg-slate-800/50 rounded-lg border border-slate-100 dark:border-slate-800{% endif %} flex items-center justify-between">
                                <div>
                                    <p
                                        class="text-sm font-bold {% if loop.first %}text-slate-900 dark:text-white{% else %}text-slate-700 dark:text-slate-300{% endif %}">
                                        {{ area.location }}</p>
                                    <p class="text-[10px] text-slate-500">{{ area.cnt }} reports</p>
                                </div>
                                {% if loop.first %}
                                <span class="text-xs font-bold text-primary">High Alert</span>
                                {% else %}
                                <span class="text-xs font-bold text-slate-400">Moderate</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                            {% if not top_areas %}
                            <p class="text-sm text-slate-400 text-center py-4">No location data available.</p>
                            {% endif %}
                        </div>
                    </div>
                    <div
                        class="bg-white dark:bg-slate-900 p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm flex flex-col justify-center">
                        <h4
                            class="text-sm font-bold text-slate-900 dark:text-white uppercase tracking-wider mb-2 text-center">
                            Summary Insight</h4>
                        <p class="text-slate-500 text-center leading-relaxed">
                            Total of <span class="text-primary font-bold">{{ total }}</span> issues tracked with a <span
                                class="text-primary font-bold">{{ resolution_rate|int }}%</span> resolution rate.
                            Average resolution time is <span class="text-primary font-bold">{{
                                "%.1f"|format(avg_resolution_hours) }}
                                hours</span>.
                        </p>
                        <div class="mt-4 flex justify-center">
                            <a href="{{ url_for('admin.dashboard') }}"
                                class="text-primary text-sm font-semibold hover:underline flex items-center gap-1">
                                Back to Dashboard <span class="material-icons text-sm">chevron_right</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Chart.js Script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('issuesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: {{ categories_labels | tojson }},
            datasets: [{
                label: 'Issues per Category',
                data: {{ categories_data | tojson }},
            backgroundColor: '#13c8ec',
            borderRadius: 4,
            barThickness: 40
                    }]
                },
            options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    },
                    ticks: {
                        stepSize: 1
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            }
        }
            });
        });
    </script>
</body>

</html>